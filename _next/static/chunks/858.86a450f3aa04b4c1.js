"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[858],{77858:(e,t,n)=>{n.r(t),n.d(t,{handleEvmTransaction:()=>I});var r=n(41918),i=n(35118),a=n(91578),l=n(36444),o=n(69432),s=n(81757),u=n(29695),c=n(32840),h=n(36984),d=n(54335),x=n(27493),f=n(7441),g=n(94201),p=n(87456),y=n(80844),q=n(67622);function w(e,t="hex"){let n=(()=>{if("string"==typeof e){if(e.length>3&&e.length%2!=0)throw new g.G6(e);return(0,y.aT)(e)}return e})();return function e(t,n="hex"){if(0===t.bytes.length)return"hex"===n?(0,q.My)(t.bytes):t.bytes;let r=t.readByte();if(r<128&&t.decrementPosition(1),r<192){let e=U(t,r,128),i=t.readBytes(e);return"hex"===n?(0,q.My)(i):i}let i=U(t,r,192);return function(t,n,r){let i=t.position,a=[];for(;t.position-i<n;)a.push(e(t,r));return a}(t,i,n)}((0,p.l)(n,{recursiveReadLimit:Number.POSITIVE_INFINITY}),t)}function U(e,t,n){if(128===n&&t<128)return 1;if(t<=n+55)return t-n;if(t===n+55+1)return e.readUint8();if(t===n+55+2)return e.readUint16();if(t===n+55+3)return e.readUint24();if(t===n+55+4)return e.readUint32();throw new f.C("Invalid RLP prefix")}var m=n(87094),b=n(50379),E=n(93727);function v(e){return w(`0x${e.slice(4)}`,"hex")}function P(e){let t=[];for(let n=0;n<e.length;n++){let[r,i]=e[n];if(!(0,s.P)(r,{strict:!1}))throw new l.M({address:r});t.push({address:r,storageKeys:i.map(e=>(0,c.q)(e)&&32===(0,m.E)(e)?e:(0,d.B)(e))})}return t}function C(e){let t=e.slice(-3),n="0x"===t[0]||0n===(0,x.uU)(t[0])?27n:28n;return{r:(0,h.db)(t[1],{size:32}),s:(0,h.db)(t[2],{size:32}),v:n,yParity:+(27n!==n)}}function I(e){return(0,r.d)(this,arguments,function*({primaryWallet:e,chain:t,serializedTransaction:n,iframeClient:r}){let l,s,{connector:h}=e,d=(0,i.b)(t);try{yield h.switchNetwork({networkChainId:d})}catch(e){console.error(`[CryptoWalletConnectionHandler] failed to switch network to ${d}`,e),r.send("crypto:send-transaction:failed",{error:e.message});return}try{if(!(0,a.p)(e))throw Error("primaryWallet is not an ethereum wallet");if(!(l=yield e.getWalletClient(String(d))))throw Error(`primaryWallet.getWalletClient(${d}) returned undefined`)}catch(e){console.error("[CryptoWalletConnectionHandler] failed to get wallet client",e),r.send("crypto:send-transaction:failed",{error:e.message});return}try{s=function(e){let t=function(e){let t=(0,E.iN)(e,0,1);if("0x04"===t)return"eip7702";if("0x03"===t)return"eip4844";if("0x02"===t)return"eip1559";if("0x01"===t)return"eip2930";if("0x"!==t&&(0,x.ME)(t)>=192)return"legacy";throw new o.gr({serializedType:t})}(e);return"eip1559"===t?function(e){let t=v(e),[n,r,i,a,l,s,u,h,d,f,g,p]=t;if(9!==t.length&&12!==t.length)throw new o.UD({attributes:{chainId:n,nonce:r,maxPriorityFeePerGas:i,maxFeePerGas:a,gas:l,to:s,value:u,data:h,accessList:d,...t.length>9?{v:f,r:g,s:p}:{}},serializedTransaction:e,type:"eip1559"});let y={chainId:(0,x.ME)(n),type:"eip1559"};return(0,c.q)(s)&&"0x"!==s&&(y.to=s),(0,c.q)(l)&&"0x"!==l&&(y.gas=(0,x.uU)(l)),(0,c.q)(h)&&"0x"!==h&&(y.data=h),(0,c.q)(r)&&"0x"!==r&&(y.nonce=(0,x.ME)(r)),(0,c.q)(u)&&"0x"!==u&&(y.value=(0,x.uU)(u)),(0,c.q)(a)&&"0x"!==a&&(y.maxFeePerGas=(0,x.uU)(a)),(0,c.q)(i)&&"0x"!==i&&(y.maxPriorityFeePerGas=(0,x.uU)(i)),0!==d.length&&"0x"!==d&&(y.accessList=P(d)),(0,b.xO)(y),{...12===t.length?C(t):void 0,...y}}(e):"eip2930"===t?function(e){let t=v(e),[n,r,i,a,l,s,u,h,d,f,g]=t;if(8!==t.length&&11!==t.length)throw new o.UD({attributes:{chainId:n,nonce:r,gasPrice:i,gas:a,to:l,value:s,data:u,accessList:h,...t.length>8?{v:d,r:f,s:g}:{}},serializedTransaction:e,type:"eip2930"});let p={chainId:(0,x.ME)(n),type:"eip2930"};return(0,c.q)(l)&&"0x"!==l&&(p.to=l),(0,c.q)(a)&&"0x"!==a&&(p.gas=(0,x.uU)(a)),(0,c.q)(u)&&"0x"!==u&&(p.data=u),(0,c.q)(r)&&"0x"!==r&&(p.nonce=(0,x.ME)(r)),(0,c.q)(s)&&"0x"!==s&&(p.value=(0,x.uU)(s)),(0,c.q)(i)&&"0x"!==i&&(p.gasPrice=(0,x.uU)(i)),0!==h.length&&"0x"!==h&&(p.accessList=P(h)),(0,b.p$)(p),{...11===t.length?C(t):void 0,...p}}(e):"eip4844"===t?function(e){let t=v(e),n=4===t.length,r=n?t[0]:t,i=n?t.slice(1):[],[a,l,s,h,d,f,g,p,y,q,w,U,m,E]=r,[I,M,W]=i;if(11!==r.length&&14!==r.length)throw new o.UD({attributes:{chainId:a,nonce:l,maxPriorityFeePerGas:s,maxFeePerGas:h,gas:d,to:f,value:g,data:p,accessList:y,...r.length>9?{v:U,r:m,s:E}:{}},serializedTransaction:e,type:"eip4844"});let N={blobVersionedHashes:w,chainId:(0,x.ME)(a),type:"eip4844"};return(0,c.q)(f)&&"0x"!==f&&(N.to=f),(0,c.q)(d)&&"0x"!==d&&(N.gas=(0,x.uU)(d)),(0,c.q)(p)&&"0x"!==p&&(N.data=p),(0,c.q)(l)&&"0x"!==l&&(N.nonce=(0,x.ME)(l)),(0,c.q)(g)&&"0x"!==g&&(N.value=(0,x.uU)(g)),(0,c.q)(q)&&"0x"!==q&&(N.maxFeePerBlobGas=(0,x.uU)(q)),(0,c.q)(h)&&"0x"!==h&&(N.maxFeePerGas=(0,x.uU)(h)),(0,c.q)(s)&&"0x"!==s&&(N.maxPriorityFeePerGas=(0,x.uU)(s)),0!==y.length&&"0x"!==y&&(N.accessList=P(y)),I&&M&&W&&(N.sidecars=(0,u.T)({blobs:I,commitments:M,proofs:W})),(0,b.zv)(N),{...14===r.length?C(r):void 0,...N}}(e):"eip7702"===t?function(e){let t=v(e),[n,r,i,a,l,s,u,h,d,f,g,p,y]=t;if(10!==t.length&&13!==t.length)throw new o.UD({attributes:{chainId:n,nonce:r,maxPriorityFeePerGas:i,maxFeePerGas:a,gas:l,to:s,value:u,data:h,accessList:d,authorizationList:f,...t.length>9?{v:g,r:p,s:y}:{}},serializedTransaction:e,type:"eip7702"});let q={chainId:(0,x.ME)(n),type:"eip7702"};return(0,c.q)(s)&&"0x"!==s&&(q.to=s),(0,c.q)(l)&&"0x"!==l&&(q.gas=(0,x.uU)(l)),(0,c.q)(h)&&"0x"!==h&&(q.data=h),(0,c.q)(r)&&"0x"!==r&&(q.nonce=(0,x.ME)(r)),(0,c.q)(u)&&"0x"!==u&&(q.value=(0,x.uU)(u)),(0,c.q)(a)&&"0x"!==a&&(q.maxFeePerGas=(0,x.uU)(a)),(0,c.q)(i)&&"0x"!==i&&(q.maxPriorityFeePerGas=(0,x.uU)(i)),0!==d.length&&"0x"!==d&&(q.accessList=P(d)),0!==f.length&&"0x"!==f&&(q.authorizationList=function(e){let t=[];for(let n=0;n<e.length;n++){let[r,i,a,l,o,s]=e[n];t.push({chainId:(0,x.ME)(r),contractAddress:i,nonce:(0,x.ME)(a),...C([l,o,s])})}return t}(f)),(0,b.dc)(q),{...13===t.length?C(t):void 0,...q}}(e):function(e){let t=w(e,"hex"),[n,r,i,a,l,s,u,h,d]=t;if(6!==t.length&&9!==t.length)throw new o.UD({attributes:{nonce:n,gasPrice:r,gas:i,to:a,value:l,data:s,...t.length>6?{v:u,r:h,s:d}:{}},serializedTransaction:e,type:"legacy"});let f={type:"legacy"};if((0,c.q)(a)&&"0x"!==a&&(f.to=a),(0,c.q)(i)&&"0x"!==i&&(f.gas=(0,x.uU)(i)),(0,c.q)(s)&&"0x"!==s&&(f.data=s),(0,c.q)(n)&&"0x"!==n&&(f.nonce=(0,x.ME)(n)),(0,c.q)(l)&&"0x"!==l&&(f.value=(0,x.uU)(l)),(0,c.q)(r)&&"0x"!==r&&(f.gasPrice=(0,x.uU)(r)),(0,b.og)(f),6===t.length)return f;let g=(0,c.q)(u)&&"0x"!==u?(0,x.uU)(u):0n;if("0x"===d&&"0x"===h)return g>0&&(f.chainId=Number(g)),f;let p=Number((g-35n)/2n);if(p>0)f.chainId=p;else if(27n!==g&&28n!==g)throw new o.zW({v:g});return f.v=g,f.s=d,f.r=h,f.yParity=+(g%2n===0n),f}(e)}(n)}catch(e){console.error("[CryptoWalletConnectionHandler] failed to parse transaction",e),r.send("crypto:send-transaction:failed",{error:e.message});return}try{let e=yield l.sendTransaction(s);console.log("[CryptoWalletConnectionHandler] txId",e),r.send("crypto:send-transaction:success",{txId:e})}catch(e){console.error("[CryptoWalletConnectionHandler] failed to send transaction",e),r.send("crypto:send-transaction:failed",{error:e.message})}})}}}]);